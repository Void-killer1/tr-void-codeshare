<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TR-VOID | CodeShare</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root{--bg:#1e1f22;--card:#313338;--text:#dbdee1;--blue:#5865F2}
body{background:var(--bg);color:var(--text);font-family:Inter,sans-serif}
.status-Working{color:#23a55a}
.status-Maintenance{color:#f0b232}
.status-NotWorking{color:#f23f43}
</style>
</head>

<body class="select-none">

<nav class="fixed top-0 w-full flex justify-between p-4 bg-black/20 backdrop-blur z-50">
  <b>TR-VOID<span class="text-blue-500">.cc</span></b>
  <button onclick="toggleSidebar()">☰</button>
</nav>

<div id="sidebar" class="fixed right-[-320px] top-0 h-full w-[300px] bg-[#2b2d31] p-6 transition-all">
  <input id="u" placeholder="Kullanıcı" class="w-full p-2 mb-2 bg-black/30 rounded">
  <input id="p" placeholder="Şifre" type="password" class="w-full p-2 mb-4 bg-black/30 rounded">
  <button onclick="login()" class="w-full bg-blue-600 p-2 rounded">Giriş</button>
  <button onclick="showAdd()" class="w-full mt-4 bg-white/10 p-2 rounded">Yeni Script</button>
</div>

<main class="pt-24 px-6 max-w-6xl mx-auto">
  <input id="srch" oninput="render()" placeholder="Oyun ara..."
  class="w-full p-4 rounded-xl bg-black/30 mb-8">

  <div id="list" class="grid md:grid-cols-3 gap-6"></div>
</main>

<!-- MODAL -->
<div id="modal" class="fixed inset-0 bg-black/80 hidden items-center justify-center">
<div class="bg-[#2b2d31] p-6 rounded-xl w-full max-w-lg">

<input id="g-srch" oninput="searchRoblox(this.value)" placeholder="Roblox oyun adı"
class="w-full p-2 mb-2 bg-black/30 rounded">

<div id="g-res" class="space-y-1 mb-2"></div>

<textarea id="s-con" oninput="updatePreview()" placeholder="Script..."
class="w-full h-24 p-2 bg-black/30 rounded mb-2"></textarea>

<select id="s-stat" onchange="updatePreview()" class="w-full p-2 bg-black/30 rounded mb-2">
<option>Working</option>
<option>Maintenance</option>
<option>NotWorking</option>
</select>

<div id="preview" class="bg-[#313338] p-4 rounded mb-4 hidden">
<img id="pv-img" class="w-16 h-16 rounded mb-2">
<b id="pv-name"></b>
<div id="pv-status"></div>
</div>

<button onclick="save()" class="w-full bg-blue-600 p-2 rounded">Kaydet</button>
<button onclick="closeAdd()" class="w-full mt-2 bg-white/10 p-2 rounded">İptal</button>

</div>
</div>

<script>
const api="/api/api";
let codes=[],selGame=null;

async function load(){
  codes=await (await fetch(api)).json();
  render();
}

function render(){
  const q=srch.value.toLowerCase();
  list.innerHTML=codes.filter(c=>c.gameName.toLowerCase().includes(q)).map(c=>`
  <div class="bg-[#313338] p-4 rounded-xl">
    <img src="${c.gameThumb}" class="w-full rounded mb-2">
    <b>${c.gameName}</b>
    <div class="status-${c.status}">${c.status}</div>
    <button onclick="copy(\`${encodeURIComponent(c.content)}\`)"
    class="w-full mt-2 bg-white/10 p-2 rounded">Kopyala</button>
  </div>`).join("");
}

async function searchRoblox(q){
  if(q.length<3)return;
  const r=await fetch(`${api}?searchGame=${q}`);
  const d=await r.json();
  g-res.innerHTML=d.map(g=>`
    <div onclick="setG('${g.name}','${g.placeId}','${g.image}')"
    class="p-2 bg-white/10 rounded cursor-pointer flex gap-2">
    <img src="${g.image}" class="w-6 h-6 rounded">${g.name}
    </div>`).join("");
}

function setG(n,i,t){
  selGame={gameName:n,gameId:i,gameThumb:t};
  updatePreview();
}

function updatePreview(){
  if(!selGame)return;
  preview.classList.remove("hidden");
  pv-img.src=selGame.gameThumb;
  pv-name.innerText=selGame.gameName;
  pv-status.innerText=s-stat.value;
}

async function save(){
  await fetch(api,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({...selGame,content:s-con.value,status:s-stat.value})
  });
  location.reload();
}

function toggleSidebar(){
  sidebar.style.right=sidebar.style.right=="0px"?"-320px":"0px";
}
function showAdd(){modal.classList.remove("hidden")}
function closeAdd(){modal.classList.add("hidden")}
function copy(t){navigator.clipboard.writeText(decodeURIComponent(t))}
async function login(){
  const u=await (await fetch(`${api}?type=users`)).json();
  if(u.find(x=>x.username===u.value&&x.password===p.value)){
    alert("Giriş OK");
  }
}

load();
</script>

</body>
</html>
